{# templates/admin/trottinette/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Gestion des Trottinettes - Admin{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# Ensure Tailwind base styles are loaded via base.html.twig #}
    {# Add any page-specific Tailwind @apply rules or minimal CSS here if absolutely needed #}
    <style>
        /* Reusable Status Badge Styles */
        .status-badge {
            padding: 0.25em 0.6em;
            border-radius: 9999px; /* pill */
            font-size: 0.7rem; /* text-xs */
            font-weight: 500; /* font-medium */
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
            line-height: 1;
        }
        .status-disponible { background-color: #dcfce7; color: #166534; } /* green */
        .status-en_location { background-color: #fef9c3; color: #854d0e; } /* yellow */
        .status-en_maintenance { background-color: #fee2e2; color: #991b1b; } /* red */

        /* Basic form input/select styles (reuse/adapt from previous) */
        .form-input { appearance: none; display: block; width: 100%; padding: 0.5rem 0.75rem; font-size: 0.875rem; line-height: 1.5; color: #1f2937; background-color: #fff; background-clip: padding-box; border: 1px solid #d1d5db; border-radius: 0.375rem; transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out; }
        .form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }
        .form-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; display: block; width: 100%; padding: 0.5rem 0.75rem; font-size: 0.875rem; line-height: 1.5; color: #1f2937; background-color: #fff; border: 1px solid #d1d5db; border-radius: 0.375rem; transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out; }
        .form-select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 1px #3b82f6; }

        /* Basic Button Styles (reuse/adapt from previous) */
        .button { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; text-align: center; cursor: pointer; transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, color 0.2s ease-in-out; border: 1px solid transparent; line-height: 1.25; font-size: 0.875rem; white-space: nowrap; }
        .button-sm { padding: 0.375rem 0.75rem; font-size: 0.75rem; } /* Smaller button */
        .button-primary { background-color: #3b82f6; color: white; border-color: #3b82f6; } .button-primary:hover { background-color: #2563eb; border-color: #1d4ed8;}
        .button-secondary { background-color: #e5e7eb; color: #374151; border-color: #d1d5db; } .button-secondary:hover { background-color: #d1d5db; border-color: #9ca3af;}
        .button-outline-primary { color: #3b82f6; border-color: #3b82f6; background-color: transparent;} .button-outline-primary:hover { background-color: #eff6ff; }
        .button-outline-secondary { color: #6b7280; border-color: #d1d5db; background-color: transparent;} .button-outline-secondary:hover { background-color: #f3f4f6; }
        .button-outline-danger { color: #dc2626; border-color: #ef4444; background-color: transparent;} .button-outline-danger:hover { background-color: #fee2e2; }
        .button:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
{% endblock %}

{% block body %}
    <div class="min-h-screen bg-gray-100 p-4 md:p-6 lg:p-8">
        <div class="container mx-auto max-w-7xl"> {# Wider container for tables #}

            {# 1. Header Section #}
            <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">
                    <i class="fas fa-motorcycle mr-2 text-blue-600"></i>Gestion des Trottinettes
                </h1>
                <a href="{{ path('admin_trottinette_new') }}" class="button button-primary">
                    <i class="fas fa-plus mr-1.5"></i> Nouvelle trottinette
                </a>
            </div>

            {# 2. Status Cards #}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                {# Available Card #}
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 flex items-center gap-4">
                    <div class="flex-shrink-0 rounded-full p-3 bg-green-100 text-green-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 uppercase tracking-wider">Disponibles</div>
                        <div class="text-2xl font-bold text-gray-900">{{ trottinettes|filter(t => t.etat.value == 'DISPONIBLE')|length }}</div>
                    </div>
                </div>
                {# Rented Card #}
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 flex items-center gap-4">
                    <div class="flex-shrink-0 rounded-full p-3 bg-yellow-100 text-yellow-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 uppercase tracking-wider">En location</div>
                        <div class="text-2xl font-bold text-gray-900">{{ trottinettes|filter(t => t.etat.value == 'EN_LOCATION')|length }}</div>
                    </div>
                </div>
                {# Maintenance Card #}
                <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6 flex items-center gap-4">
                    <div class="flex-shrink-0 rounded-full p-3 bg-red-100 text-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 uppercase tracking-wider">En maintenance</div>
                        <div class="text-2xl font-bold text-gray-900">{{ trottinettes|filter(t => t.etat.value == 'EN_MAINTENANCE')|length }}</div>
                    </div>
                </div>
            </div>

            {# 3. Flash Messages #}
            {% include 'partials/_flash_messages.html.twig' ignore missing %} {# Assuming Tailwind styled #}

            {# 4. Search and Filter Form - Assuming Server-Side Filtering #}
            {# Remove the client-side JS filter script if using this form #}
            <form method="get" action="{{ path('admin_trottinette_index') }}" class="bg-white rounded-lg shadow p-4 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
                    {# Search Input #}
                    <div class="md:col-span-2 lg:col-span-2">
                        <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Rechercher</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"> <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /> </svg>
                            </div>
                            <input type="search" id="search-input" name="search" class="form-input pl-10" placeholder="Modèle, N° Série, Lieu..." value="{{ app.request.query.get('search', '') }}">
                        </div>
                    </div>
                    {# Status Filter #}
                    <div>
                        <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-1">État</label>
                        <select id="status-filter" name="status" class="form-select">
                            <option value="">Tous les états</option>
                            <option value="DISPONIBLE" {{ app.request.query.get('status') == 'DISPONIBLE' ? 'selected' }}>Disponible</option>
                            <option value="EN_LOCATION" {{ app.request.query.get('status') == 'EN_LOCATION' ? 'selected' }}>En location</option>
                            <option value="EN_MAINTENANCE" {{ app.request.query.get('status') == 'EN_MAINTENANCE' ? 'selected' }}>En maintenance</option>
                        </select>
                    </div>
                    {# Submit Button #}
                    <div>
                        <button type="submit" class="button button-primary w-full">
                            <i class="fas fa-filter mr-1.5"></i> Filtrer
                        </button>
                    </div>
                </div>
            </form>

            {# 5. Table Section #}
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200" id="trottinetteTable-server"> {# Renamed ID if old JS is removed #}
                        <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modèle</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° Série</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilisateur</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pt Relais</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">État</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Batterie</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Localisation</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Autonomie</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                        {% for trottinette in trottinettes %} {# Assumes server-side pagination/filtering provides the correct list #}
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">{{ trottinette.id }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">{{ trottinette.modele }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ trottinette.numeroSerie }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                    {% if trottinette.utilisateur %}
                                        {# Link to user maybe? #}
                                        {{ trottinette.utilisateur.prenom }} {{ trottinette.utilisateur.nom }}
                                        <span class="text-xs text-gray-400">(ID:{{ trottinette.utilisateur.id }})</span>
                                    {% else %}
                                        <span class="text-gray-400 italic">N/A</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                    {# Link to point relais maybe? #}
                                    {{ trottinette.pointRelais ? trottinette.pointRelais.nom : 'N/A' }}
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm">
                                <span class="status-badge status-{{ trottinette.etat.value|lower }}">
                                     {{ trottinette.etat.value|replace({'_': ' '})|capitalize }}
                                </span>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                                    <div class="flex items-center gap-2">
                                        <div class="w-16 bg-gray-200 rounded-full h-1.5 dark:bg-gray-700">
                                            {% set batteryColor = 'bg-red-500' %}
                                            {% if trottinette.batterie > 70 %}
                                                {% set batteryColor = 'bg-green-500' %}
                                            {% elseif trottinette.batterie > 30 %}
                                                {% set batteryColor = 'bg-yellow-500' %}
                                            {% endif %}
                                            <div class="{{ batteryColor }} h-1.5 rounded-full" style="width: {{ trottinette.batterie }}%"></div>
                                        </div>
                                        <span>{{ trottinette.batterie }}%</span>
                                    </div>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ trottinette.localisation|default('N/A') }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ trottinette.autonomie|default('N/A') }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium space-x-1">
                                    <a href="{{ path('admin_trottinette_show', {'id': trottinette.id}) }}" class="button button-sm button-outline-primary" title="Voir">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ path('admin_trottinette_edit', {'id': trottinette.id}) }}" class="button button-sm button-outline-secondary" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    {# Delete Form - replaces modal trigger #}
                                    <form method="post" action="{{ path('admin_trottinette_delete', {'id': trottinette.id}) }}" onsubmit="return confirm('Supprimer la trottinette {{ trottinette.modele }} ({{ trottinette.numeroSerie }}) ?');" class="inline-block">
                                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ trottinette.id) }}">
                                        <button type="submit" class="button button-sm button-outline-danger" title="Supprimer">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="10" class="text-center py-12 px-6 text-gray-500">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                                    </svg>
                                    <h3 class="mt-2 text-sm font-medium text-gray-900">Aucune trottinette trouvée</h3>
                                    <p class="mt-1 text-sm text-gray-500">Essayez de modifier vos filtres ou ajoutez une nouvelle trottinette.</p>
                                    {% if app.request.query.get('search') or app.request.query.get('status') %}
                                        <div class="mt-6">
                                            <a href="{{ path('admin_trottinette_index') }}" class="button button-sm button-secondary">
                                                Réinitialiser les filtres
                                            </a>
                                        </div>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            {# 6. Pagination (If using server-side pagination) #}
            {# Example using KnpPaginatorBundle - adapt if needed #}
            {# {% if trottinettes.getTotalItemCount > trottinettes.getItemNumberPerPage() %}
        <div class="mt-6">
             {{ knp_pagination_render(trottinettes) }}
             <div class="text-sm text-gray-600 mt-2 text-center">
                Affichage de {{ trottinettes.firstItemNumber }} à {{ trottinettes.lastItemNumber }} sur {{ trottinettes.getTotalItemCount }}.
             </div>
        </div>
        {% endif %} #}

        </div> {# End Container #}
    </div> {# End Page Wrapper #}

    {# Remove the old client-side filter JS #}
    {# {% block javascripts %} ... {% endblock %} #}
{% endblock %}