{# templates/public/event/_event_card.html.twig #}
{# Expects event_data: ['entity' => Event, 'duration' => string|null, 'user_participation_status' => ParticipationStatus|null] #}
{% set event = event_data.entity %}
{#{% set duration = event_data.duration %}#}
{#{% set user_status = event_data.user_participation_status %} #}{# Get participation status #}
{% set user_status = event_data.user_participation_status|default(null) %}

<div data-lov-id="src/pages/Events.tsx:113:12" class="event-card bg-white rounded-lg shadow-md overflow-hidden"> {# Use classes from CSS #}
    {# Card Header with Title #}
    <div data-lov-id="src/pages/Events.tsx:114:14" class="event-card-header h-32 bg-gradient-to-r from-green-400 to-green-600 flex items-center justify-center">
        <h3 data-lov-id="src/pages/Events.tsx:115:16" class="event-card-title text-2xl font-bold text-white text-center px-2">
            {{ event.titre }}
        </h3>
    </div>

    {# Card Body #}
    <div data-lov-id="src/pages/Events.tsx:118:14" class="p-6 event-card-body"> {# Use classes from CSS #}
        {# Description (Clipped) #}
        <p data-lov-id="src/pages/Events.tsx:119:16" class="event-card-description text-gray-700 mb-4 line-clamp-3"> {# Use classes from CSS #}
            {{ event.description|striptags|slice(0, 120) ~ (event.description|length > 120 ? '...' : '') }}
        </p>

        {# Metadata Section #}
        <div data-lov-id="src/pages/Events.tsx:121:16" class="event-card-meta space-y-2 mb-6"> {# Use classes from CSS #}
            {# Date #}
            <div data-lov-id="src/pages/Events.tsx:122:18" class="event-meta-item flex items-center gap-2">
                {# Calendar Icon SVG #}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-gray-500"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>
                <span data-lov-id="src/pages/Events.tsx:124:20" class="event-meta-text">{{ event.dateDebut ? event.dateDebut|date('d M Y \\à H:i') : 'N/A' }}</span>
            </div>
            {# Duration #}
            {% if true %}
                <div data-lov-id="src/pages/Events.tsx:127:18" class="event-meta-item flex items-center gap-2">
                    {# Clock Icon SVG #}
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-gray-500"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    <span data-lov-id="src/pages/Events.tsx:129:20" class="event-meta-text">Durée: 4</span>
                </div>
            {% endif %}
            {# Location #}
            <div data-lov-id="src/pages/Events.tsx:137:18" class="event-meta-item flex items-center gap-2">
                {# MapPin Icon SVG #}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-gray-500"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg>
                <span data-lov-id="src/pages/Events.tsx:139:20" class="event-meta-text">{{ event.state ? event.state.label : 'Non défini' }}</span>
            </div>
            {# Participants #}
            <div data-lov-id="src/pages/Events.tsx:142:18" class="event-meta-item flex items-center gap-2">
                {# Users Icon SVG #}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-gray-500"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                <span data-lov-id="src/pages/Events.tsx:144:20" class="event-meta-text">{{ event.participations|length }} participant(s)</span>
            </div>
        </div>

        {# Footer Section with Status Badge and Buttons #}
        <div data-lov-id="src/pages/Events.tsx:148:16" class="flex items-center justify-between"> {# Use classes from CSS #}
            {# Status Badge #}
            <span data-lov-id="src/pages/Events.tsx:149:18" class="status-badge status-{{ event.statut|lower }}"> {# Use dynamic class for styling #}
                {# {{ event.statut|replace({'_': ' '})|capitalize }} #}
                {% if event.statut == 'A_VENIR' %}À venir
                {% elseif event.statut == 'EN_COURS' %}En cours
                {% elseif event.statut == 'TERMINE' %}Terminé
                {% elseif event.statut == 'ANNULE' %}Annulé
                {% else %}{{ event.statut|default('') }}{% endif %}
            </span>

            {# Action Buttons #}
            <div data-lov-id="src/pages/Events.tsx:158:18" class="flex gap-2">
                {# Details Button #}
                <a data-lov-id="src/pages/Events.tsx:159:20" href="{{ path('public_event_show', {'id': event.id}) }}">
                    <button data-lov-id="src/pages/Events.tsx:160:22" class="button button-secondary button-small"> {# Added button-small #}
                        Détails
                    </button>
                </a>

                {# Participate Button (Conditional Logic) #}
                {# Only show if event is upcoming AND user is logged in #}
                {% if event.statut == 'A_VENIR' and is_granted('IS_AUTHENTICATED_FULLY') %}
                    {# Check if user is already participating #}
                    {% if user_status == constant('App\\Enum\\ParticipationStatus::INSCRIT') %}
                        <button class="button button-secondary-outline button-small" disabled> {# Example style #}
                            <i class="fas fa-check"></i> Inscrit
                        </button>
                    {% elseif user_status == constant('App\\Enum\\ParticipationStatus::ANNULE') %}
                        {# Optionally allow re-participation - Link to participate action #}
                        <a href="{{ path('app_event_participate', {'id': event.id}) }}" class="button button-primary button-small">
                            <i class="fas fa-redo"></i> Réinscrire
                        </a>
                    {% else %}
                        {# Participate Button - Link to participate action #}
                        <a href="{{ path('app_event_participate', {'id': event.id}) }}" class="button button-primary button-small">
                            <i class="fas fa-user-plus"></i> Participer
                        </a>
                    {% endif %}
                {% elseif event.statut == 'A_VENIR' %}
                    {# Show login prompt if not logged in for upcoming events #}
                    <a href="{{ path('app_login') }}" class="button button-secondary button-small">
                        <i class="fas fa-sign-in-alt"></i> Connexion
                    </a>
                {% else %}
                    {# Event not upcoming or user not logged in, button disabled/hidden #}
                    {# <button class="button button-secondary button-small" disabled>Participer</button> #}
                {% endif %}
            </div>
        </div>
    </div> {# End Card Body #}
</div> {# End Card #}